<!DOCTYPE html>

<html lang="en">

  <head>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>ğŸš€ WorldLink Network Testnet</title>

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <style>

      body {

        background: black;

        color: aqua;

        font-family: Arial, sans-serif;

        text-align: center;

        padding: 40px;

      }

      button {

        background: gold;

        color: black;

        font-weight: bold;

        padding: 10px 20px;

        border: none;

        border-radius: 6px;

        cursor: pointer;

      }

      #status {

        margin-top: 20px;

        font-size: 18px;

      }

    </style>

  </head>



  <body>

    <h2>ğŸš€ WorldLink Network Testnet is Live!</h2>

    <p>Connected to Pi Testnet via Express Server</p>



    <button id="loginBtn">Login with Pi</button>

    <button id="payBtn">Pay with Pi</button>



    <p id="status">ğŸŸ¢ Ready</p>



    <script>

      // ğŸ§© Báº¯t lá»—i toÃ n cá»¥c

      window.onerror = function (msg, url, line, col, error) {

        console.error("âš ï¸ JS Error:", msg, "at", line + ":" + col, error);

        document.getElementById("status").innerText =

          "âš ï¸ JS Error: " + msg + " (line " + line + ")";

      };



      // ğŸŸ£ Khá»Ÿi táº¡o SDK

      Pi.init({ version: "2.0", sandbox: true });

      console.log("âœ… Pi SDK initialized");



      // ğŸŸ¢ Kiá»ƒm tra SDK

      if (typeof Pi === "undefined") {

        document.getElementById("status").innerText =

          "âš ï¸ SDK not loaded. Please open in Pi Browser.";

        throw new Error("Pi SDK missing");

      } else {

        document.getElementById("status").innerText =

          "âœ… Pi SDK detected successfully.";

      }



      // ğŸŸ¡ Login

      document.getElementById("loginBtn").addEventListener("click", async () => {

        try {

          document.getElementById("status").innerText = "ğŸ”‘ Logging in...";

          const scopes = ["payments"];

          const user = await Pi.authenticate(scopes, (onIncompletePaymentFound) => {

            console.log("ğŸ” Incomplete payment found:", onIncompletePaymentFound);

          });

          console.log("âœ… Logged in user:", user);

          document.getElementById("status").innerText =

            "âœ… Logged in as " + user.username;

        } catch (err) {

          console.error("âŒ Login failed:", err);

          document.getElementById("status").innerText = "âŒ Login failed.";

        }

      });



      // ğŸ’³ Payment

      document.getElementById("payBtn").addEventListener("click", async () => {

        try {

          document.getElementById("status").innerText = "ğŸ’³ Processing payment...";

          console.log("ğŸ’° Starting Pi payment...");



          const payment = await Pi.createPayment({

            amount: 0.01,

            memo: "WorldLink Test Payment",

            metadata: { type: "test" },

            onReadyForServerApproval: (paymentId) => {

              console.log("ğŸŸ¡ Ready for approval:", paymentId);

            },

            onReadyForServerCompletion: (paymentId, txid) => {

              console.log("ğŸŸ¢ Ready for completion:", paymentId, txid);

            },

            onCancel: () => {

              document.getElementById("status").innerText = "âŒ Payment cancelled.";

              console.warn("âŒ Payment cancelled.");

            },

            onError: (error) => {

              document.getElementById("status").innerText =

                "âŒ Payment failed or cancelled.";

              console.error("âŒ Payment failed:", error);

            },

          });



          console.log("âœ… Payment object:", payment);

        } catch (err) {

          console.error("âš ï¸ Payment error:", err);

          document.getElementById("status").innerText = "âš ï¸ Payment error.";

        }

      });

    </script>

  </body>

</html>

