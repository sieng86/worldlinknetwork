<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>ğŸš€ WorldLink Network Testnet</title>

  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <style>

    body {

      background-color: black;

      color: cyan;

      text-align: center;

      font-family: Arial, sans-serif;

      padding-top: 50px;

    }

    h1 {

      color: #00ffff;

    }

    button {

      background-color: #ffcc00;

      border: none;

      padding: 12px 25px;

      border-radius: 6px;

      margin: 10px;

      cursor: pointer;

      font-weight: bold;

    }

    #status {

      margin-top: 25px;

      font-size: 18px;

      color: cyan;

      word-break: break-word;

    }

  </style>

</head>

<body>

  <h1>ğŸš€ WorldLink Network Testnet is Live!</h1>

  <p>Connected to Pi Testnet via Express Server</p>



  <button id="loginButton">Login with Pi</button>

  <button id="payButton">Pay with Pi</button>



  <p id="status">ğŸ” Checking Pi SDK...</p>



  <script>

    // ğŸ§  Báº¯t lá»—i JS toÃ n cá»¥c

    window.onerror = function (msg, url, line, col, error) {

      console.error("âš ï¸ JS Error:", msg, "at", line + ":" + col, error);

      document.getElementById("status").innerHTML = "âš ï¸ JS Error: " + msg;

    };



    window.onload = async () => {

      console.log("ğŸš€ Checking Pi SDK...");



      // ğŸŸ¡ Kiá»ƒm tra SDK cÃ³ tá»“n táº¡i hay khÃ´ng

      if (typeof Pi === "undefined" || !Pi.init) {

        console.error("âŒ Pi SDK not found. Possibly wrong domain or outside Pi Browser.");

        document.getElementById("status").innerHTML =

          "âš ï¸ Pi SDK not loaded. Please open this page in <b>Pi Browser</b> at:<br><b>https://worldlinknetwork.org</b>";

        return;

      }



      // âœ… SDK Ä‘Æ°á»£c nháº­n diá»‡n

      console.log("âœ… Pi SDK detected:", Pi);

      document.getElementById("status").innerText = "âœ… Pi SDK detected successfully.";



      // ğŸ§© Khá»Ÿi táº¡o SDK á»Ÿ Testnet

      Pi.init({ version: "2.0", sandbox: true });



      // ğŸ”‘ LOGIN FUNCTION

      document.getElementById("loginButton").addEventListener("click", async () => {

        try {

          document.getElementById("status").innerText = "ğŸ”‘ Logging in...";

          const scopes = ["username", "payments"];

          const auth = await Pi.authenticate(scopes, (payment) => {

            console.log("New payment:", payment);

          });

          console.log("âœ… Auth success:", auth);

          document.getElementById("status").innerText =

            "âœ… Logged in as @" + auth.user.username;

        } catch (err) {

          console.error("âŒ Login failed:", err);

          document.getElementById("status").innerText =

            "âŒ Login failed: " + (err.message || err);

        }

      });



      // ğŸ’° PAYMENT FUNCTION

      document.getElementById("payButton").addEventListener("click", async () => {

        try {

          document.getElementById("status").innerText = "ğŸ’° Starting Pi payment...";

          const payment = await Pi.createPayment(

            {

              amount: 1,

              memo: "Test payment from WorldLink Network",

              metadata: { purpose: "demo" },

            },

            {

              onReadyForServerApproval: (paymentId) => {

                console.log("âœ… Ready for server approval:", paymentId);

              },

              onReadyForServerCompletion: (paymentId, txid) => {

                console.log("âœ… Ready for server completion:", paymentId, txid);

              },

              onCancel: (reason) => {

                console.warn("âŒ Payment cancelled:", reason);

                document.getElementById("status").innerText = "âŒ Payment cancelled.";

              },

              onError: (error) => {

                console.error("âš ï¸ Payment error:", error);

                document.getElementById("status").innerText =

                  "âš ï¸ Payment failed: " + (error.message || error);

              },

            }

          );

        } catch (err) {

          console.error("âŒ Error creating payment:", err);

          document.getElementById("status").innerText =

            "âŒ Error creating payment: " + (err.message || err);

        }

      });

    };

  </script>

</body>

</html>

