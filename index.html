<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>üöÄ WorldLink Network Testnet</title>

  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <style>

    body {

      background-color: #000;

      color: cyan;

      font-family: Arial, sans-serif;

      text-align: center;

      padding-top: 60px;

    }

    h1 {

      color: cyan;

      font-size: 26px;

    }

    button {

      background-color: #ffcc00;

      border: none;

      border-radius: 6px;

      padding: 12px 24px;

      margin: 10px;

      cursor: pointer;

      font-weight: bold;

      opacity: 0.5;

      pointer-events: none;

      transition: 0.3s;

    }

    button.enabled {

      opacity: 1;

      pointer-events: auto;

    }

    #status {

      color: cyan;

      margin-top: 20px;

      font-size: 18px;

    }

  </style>

</head>

<body>

  <h1>üöÄ WorldLink Network Testnet is Live!</h1>

  <p>Connected to Pi Testnet via Express Server</p>



  <button id="loginBtn">Login with Pi</button>

  <button id="payBtn">Pay with Pi</button>



  <p id="status">üîç Checking Pi SDK...</p>



  <script>

    let userAuth = null;

    const statusEl = document.getElementById("status");



    window.onerror = (msg, url, line) => {

      console.error("‚ö†Ô∏è JS Error:", msg);

      statusEl.innerHTML = "‚ö†Ô∏è JS Error: " + msg;

    };



    function enableButtons() {

      document.querySelectorAll("button").forEach((b) => b.classList.add("enabled"));

    }



    window.onload = async () => {

      if (typeof Pi === "undefined" || !Pi.init) {

        statusEl.innerHTML =

          "‚ö†Ô∏è Pi SDK not found. Please open this site in <b>Pi Browser</b>.";

        return;

      }



      // ‚úÖ K√≠ch ho·∫°t SDK (testnet mode)

      Pi.init({ version: "2.0", sandbox: true });

      console.log("‚úÖ Pi SDK initialized");

      statusEl.textContent = "‚úÖ Pi SDK detected successfully.";

      enableButtons();



      // üü° LOGIN

      document.getElementById("loginBtn").addEventListener("click", async () => {

        try {

          statusEl.textContent = "üîë Logging in...";

          const scopes = ["username", "payments"];

          const auth = await Pi.authenticate(scopes, (payment) => {

            console.log("üí¨ Payment callback:", payment);

          });

          userAuth = auth;

          statusEl.textContent = "‚úÖ Logged in as @" + auth.user.username;

        } catch (err) {

          console.error("‚ùå Login failed:", err);

          statusEl.textContent = "‚ùå Login failed: " + err.message;

        }

      });



      // üí∞ PAYMENT

      document.getElementById("payBtn").addEventListener("click", async () => {

        if (!userAuth) {

          statusEl.textContent = "‚ö†Ô∏è Please login first!";

          return;

        }



        try {

          statusEl.textContent = "üí∞ Creating test payment...";

          await Pi.createPayment(

            {

              amount: 1,

              memo: "WorldLink Test Payment",

              metadata: { source: "demo" },

            },

            {

              onReadyForServerApproval: (paymentId) => {

                console.log("üü° Ready for approval:", paymentId);

              },

              onReadyForServerCompletion: (paymentId, txid) => {

                console.log("‚úÖ Completed:", paymentId, txid);

                statusEl.textContent = "‚úÖ Payment completed!";

              },

              onCancel: () => {

                statusEl.textContent = "‚ùå Payment cancelled.";

              },

              onError: (err) => {

                console.error("‚ö†Ô∏è Payment error:", err);

                statusEl.textContent = "‚ö†Ô∏è Payment error: " + err.message;

              },

            }

          );

        } catch (err) {

          console.error("‚ùå Payment failed:", err);

          statusEl.textContent = "‚ùå Error: " + err.message;

        }

      });

    };

  </script>

</body>

</html>

